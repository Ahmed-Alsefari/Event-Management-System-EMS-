
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-card {
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<!-- Top Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container-fluid">
        <span class="navbar-brand">ðŸ”§ Admin Panel</span>

        <div class="navbar-nav mx-auto">
            <a class="nav-link active" th:href="@{/admin/dashboard}">Dashboard</a>
            <a class="nav-link" th:href="@{/admin/packages}">Service Packages</a>
            <a class="nav-link" th:href="@{/admin/reservations}">Reservations</a>
        </div>

        <div>
            <form th:action="@{/logout}" method="post" class="d-inline">
                <button type="submit" class="btn btn-outline-light">Logout</button>
            </form>
        </div>
    </div>
</nav>

<div class="container-fluid mt-4">
    <h2 class="mb-4">ðŸ“Š Dashboard Overview</h2>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card stat-card bg-primary text-white shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle mb-2">Total Bookings</h6>
                            <h2 class="mb-0" th:text="${totalBookings}">0</h2>
                        </div>
                        <i class="fas fa-calendar-check stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card stat-card bg-success text-white shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle mb-2">Total Revenue</h6>
                            <h2 class="mb-0">$<span th:text="${totalRevenue}">0</span></h2>
                        </div>
                        <i class="fas fa-dollar-sign stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card stat-card bg-warning text-white shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle mb-2">Pending</h6>
                            <h2 class="mb-0" th:text="${pendingCount}">0</h2>
                        </div>
                        <i class="fas fa-clock stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card stat-card bg-info text-white shadow">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle mb-2">Confirmed</h6>
                            <h2 class="mb-0" th:text="${confirmedCount}">0</h2>
                        </div>
                        <i class="fas fa-check-circle stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Revenue Trend (Last 6 Months)</h5>
                </div>
                <div class="card-body">
                    <canvas id="revenueChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Bookings Trend (Last 6 Months)</h5>
                </div>
                <div class="card-body">
                    <canvas id="bookingsChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body text-center">
                    <i class="fas fa-calculator text-primary fa-3x mb-3"></i>
                    <h6 class="text-muted">Average Booking Value</h6>
                    <h3 class="text-primary">$<span th:text="${avgBookingValue}">0</span></h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body text-center">
                    <i class="fas fa-percentage text-success fa-3x mb-3"></i>
                    <h6 class="text-muted">Confirmation Rate</h6>
                    <h3 class="text-success"><span th:text="${confirmationRate}">0</span>%</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body text-center">
                    <i class="fas fa-calendar-day text-info fa-3x mb-3"></i>
                    <h6 class="text-muted">This Month</h6>
                    <h3 class="text-info" th:text="${thisMonthBookings}">0</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body text-center">
                    <i class="fas fa-box text-warning fa-3x mb-3"></i>
                    <h6 class="text-muted">Active Packages</h6>
                    <h3 class="text-warning" th:text="${#lists.size(packages)}">0</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="fas fa-history"></i> Recent Activity</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Event Title</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Seats</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="event : ${recentActivity}">
                                <td th:text="${event.id}"></td>
                                <td th:text="${event.title}"></td>
                                <td th:text="${event.date}"></td>
                                <td th:text="${event.location}"></td>
                                <td th:text="${event.seats}"></td>
                                <td>
                                        <span th:class="${'badge ' +
                                            (event.status == 'Confirmed' ? 'bg-success' :
                                             event.status == 'Cancelled' ? 'bg-danger' : 'bg-warning')}"
                                              th:text="${event.status}"></span>
                                </td>
                                <td>
                                    <a th:href="@{'/admin/reservations/' + ${event.id}}"
                                       class="btn btn-sm btn-primary">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const revenueTrendData = /*[[${revenueTrend}]]*/ {};
    const revenueLabels = Object.keys(revenueTrendData);
    const revenueValues = Object.values(revenueTrendData);

    const revenueData = {
        labels: revenueLabels,
        datasets: [{
            label: 'Revenue ($)',
            data: revenueValues,
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.4
        }]
    };
    new Chart(revenueCtx, {
        type: 'line',
        data: revenueData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true }
            }
        }
    });

    // Bookings Chart
    const bookingsCtx = document.getElementById('bookingsChart').getContext('2d');
    const bookingsTrendData = /*[[${bookingsTrend}]]*/ {};
    const bookingsLabels = Object.keys(bookingsTrendData);
    const bookingsValues = Object.values(bookingsTrendData);

    const bookingsData = {
        labels: bookingsLabels,
        datasets: [{
            label: 'Bookings',
            data: bookingsValues,
            backgroundColor: 'rgba(54, 162, 235, 0.8)',
            borderColor: 'rgb(54, 162, 235)',
            borderWidth: 1
        }]
    };
    new Chart(bookingsCtx, {
        type: 'bar',
        data: bookingsData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: true }
            }
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
